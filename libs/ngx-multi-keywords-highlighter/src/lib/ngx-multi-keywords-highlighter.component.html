<button
  mat-icon-button
  aria-hidden="false"
  aria-label="Multi keywords highlighter"
  [color]="config.themeColor"
  [matTooltip]="appName"
  [matMenuTriggerFor]="menu"
  (menuOpened)="onOpened()"
  (menuClosed)="onClosed()"
  #menuTrigger="matMenuTrigger"
  data-testid="highlight-keywords-button"
>
  <mat-icon
    id="mh-keyword-count"
    aria-hidden="false"
    aria-label="Keywords highlights icon"
    [matBadge]="keywordCount$ | async"
    [matBadgeHidden]="(keywordCount$ | async) === 0"
    matBadgePosition="after"
    matBadgeColor="accent"
    svgIcon="highlight"
  ></mat-icon>
</button>
<mat-menu
  backdropClass="mh-backdrop"
  class="mh-menu"
  #menu="matMenu"
  xPosition="before"
  yPosition="below"
  data-testid="highlight-keywords-menu"
>
  <div
    class="mh-panel flex flex-col"
    (click)="$event.stopPropagation()"
    [ngStyle]="{ minWidth: config.minWidth + 'px' }"
  >
    <div class="mh-header flex flex-row items-center justify-between">
      <span class="mh-text">
        <span class="mr-1">{{ appName }}</span>
        <small class="mh-version mh-text-tint">{{ appVersion }}</small>
      </span>
      <div class="mh-actions flex flex-row items-center justify-end">
        <ng-container *ngIf="config.enableColorPalette">
          <button
            mat-icon-button
            aria-label="Color theme"
            [color]="config.themeColor"
            [matMenuTriggerFor]="colorMenu"
          >
            <mat-icon svgIcon="color_lens"></mat-icon>
          </button>
          <mat-menu
            backdropClass="mh-backdrop"
            class="mh-menu"
            #colorMenu="matMenu"
            xPosition="before"
            yPosition="below"
          >
            <div class="flex" (click)="$event.stopPropagation()">
              <!-- <lib-color-palette></lib-color-palette> -->
            </div>
          </mat-menu>
        </ng-container>
        <mat-slide-toggle
          class="mh-toggle"
          [checked]="highlightStauts$ | async"
          [matTooltip]="config.enableHighlighterTooltip"
          [labelPosition]="config.toggleLabelPosition"
          [color]="config.themeColor"
          (change)="onToggle($event)"
          ariaLabel="Toggle Highlighter"
          data-testid="highlight-keywords-slide-toggle"
        >
          <ng-container *ngIf="config.enableToggleLabel">
            <span class="mh-text">{{ highlightedStautsText$ | async }}</span>
          </ng-container>
        </mat-slide-toggle>
      </div>
    </div>
    <div class="mh-body" fxLayout="column">
      <div class="mh-content">
        <mat-form-field class="mh-keyword-list" appearance="fill">
          <mat-label>{{ config.keywordsPlaceholder }}</mat-label>
          <mat-chip-grid aria-label="Enter keywords" #keywordChipList>
            <mat-chip-row
              *ngFor="let keyword of keywordList$ | async; trackBy: trackById"
              selectable="true"
              [removable]="config.removable"
              (removed)="removeKeyword(keyword)"
              [ngStyle]="{ 'background-color': keyword?.color }"
            >
              <span
                matTooltip="{{
                  keyword.name.length >= 36 ? keyword.name : null
                }}"
                class="mh-keyword-list-text"
                [ngStyle]="{ color: config.chipTextColor }"
              >
                {{ keyword.name }}
              </span>
              <mat-icon
                class="border-icon"
                svgIcon="clear"
                matTooltip="Clear"
                matChipRemove
                *ngIf="config.removable"
                [ngStyle]="{ fill: config.chipIconColor }"
              >
              </mat-icon>
            </mat-chip-row>
          </mat-chip-grid>
          <input
            placeholder="{{ config.keywordsPlaceholder }}"
            [matChipInputFor]="keywordChipList"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            [matChipInputAddOnBlur]="true"
            (matChipInputTokenEnd)="addKeyword($event)"
          />
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutAlign="space-between center">
        <span class="mh-text mh-text-tint"
          >Separate by comma [,] or enter key</span
        >
        <span class="mh-text mh-text-tint">
          <ng-container *ngIf="config.linkToCopyright; else normalCopyright">
            &copy;
            <a
              [href]="copyrightLink"
              class="mh-copyright underline"
              target="_blank"
              >{{ copyright }}</a
            >
          </ng-container>
          <ng-template #normalCopyright>
            <span class="mh-copyright">&copy; {{ copyright }}</span>
          </ng-template>
          <span class="ml-1">{{ currentYear | date : 'yyyy' }}</span>
        </span>
      </div>
    </div>
  </div>
</mat-menu>
